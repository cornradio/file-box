<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- emoji icon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì¶</text></svg>"
        type="image/x-icon">
    <title>box1</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #262626;
            color: #666;
        }

        .item1 {
            /* margin: 0 10px; */
            height: 100vh;
            min-width: 380px;
            max-width: 30%;
            box-shadow: 0 0 10px rgb(0, 0, 0);
        }


        .filelist {
            /* overflow-y: scroll; */
            background-color: #0000002d;

        }

        .file {
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
            vertical-align:middle;
            /* box-shadow:inset 0px -10px 2px rgba(109, 109, 109, 0.062),
            inset 0px 16px 2px rgba(255, 255, 255, 0.59); */
            /* overflow: hidden; */
            border-bottom: 1px solid rgb(0 0 0 / 50%);
            height: 1.6em;
            color: rgb(212, 212, 212);
            padding: 0 5px 0 5px;
        }
        .file-name{
            text-wrap: nowrap;
            display: inline-block;
        }

        .file:hover {
            background-color: #07845e2f !important;
            color: rgba(164, 229, 23, 0.696);
        }

        .file-actions {
            margin-left: auto;
        }

        .file:nth-child(even) {
            background-color: #00000012;
        }

        button:hover {
            transform: scale(1.2);
        }

        button:active {
            transform: scale(0.9);
        }

        .file-actions button {
            background-color: transparent;
            border: none;
            width: 22px;
        }

        .file-actions button:last-child {
            margin-right: 1px;
        }


        /* .file-actions button:nth-child(1){
            background-color: greenyellow;
        }
        .file-actions button:nth-child(2){
            background-color: red;
            color: #fff;
        } */


        /* ÊéßÂà∂Âè∞ Êìç‰ΩúÊåâÈíÆÁ≠â */
        .panel {
            background-color: #1b1b1b;
            color: rgba(255, 255, 255, 0.307);
            padding: 0;
            margin: 0;
            padding-bottom: .5em;
            border: 0;
            overflow: hidden;
        }

        .panel button {
            float: right;
            background-color: transparent !important;
            color: rgb(0, 255, 213);
            min-width: 20%;
            border: none;

        }

        .panel input {
            padding-left: .7em;
            width: 70%;
            background: transparent;
            border: none;
            color: white;
        }

        .panel label {
            width: 70%;
            padding-left: .7em;
            font-size: small;
        }

        .panel h1 {
            margin: 0;
            line-height: 2em;
            margin-left: .2em;
            color: #ffffff;
            text-shadow: 0 0 1px black;
        }

        input[type="file"] {
            display: none;
        }
    </style>
    <style>
        /* toast */
        #toastContainer {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 9999;
            transition: all 0.3s ease-in-out;
        }

        .toast {
            background-color: #f1f1f1;
            border: 1px solid #afafaf;
            color: #000000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            font-size: smaller;
            padding: 5px 10px;
            border-radius: 100px;
            margin-bottom: 10px;
            opacity: 0;
            animation: float-in 0.3s ease-in-out;
            /* transition: 0.3s ease-in-out; */
        }

        .toast.dark-mode {
            background-color: #444;
            border: 1px solid #2d2d2d;
            color: #d8d8d8;
        }

        .toast.show {
            opacity: 0.8;
        }

        .toast.hide {
            animation: slide-out 0.5s ease-in-out;
        }

        @keyframes float-in {
            0% {
                transform: translateY(20px);
            }

            100% {
                transform: translateY(0);
            }
        }

        @keyframes slide-out {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-20px);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <div class="grid-container">

        <div class="item item1">

            <div class="panel">
                <h1>üì¶ file-box</h1>
                <div class="fileinput">
                    <input id="file_lable" onclick="choosefile()" placeholder="choose_file" for="the_file"></input>
                    <input id="the_file" type="file" />
                    <button type="submit" onclick="uploadFile()">üì§ Upload</button>
                </div>
                <input id="boxname" placeholder="box_name" />
                <button>üîÄ Switch</button>
                <input id="filesearch" placeholder="keyword" />
                <button>üîé Search</button>
                <input id="filelist_info" placeholder="3_files" />
                <button onclick="refreshFilelist()">üîÑ Reload</button>
            </div>

            <div class="filelist">
                <div class="file">
                    <span class="file-icon">üñºÔ∏è</span>
                    <small class="file-name">image.png</small>
                    <span class="file-actions">
                        <button>üíæ</button>
                        <button>üóëÔ∏è</button>
                    </span>
                </div>
            </div>
            <div id="toastContainer"></div>


        </div>
    </div>

</body>
<script>
    // Toast
    function showToast(textContent, darkMode) {
        var toast = document.createElement('div');// ÂàõÂª∫ToastÂÖÉÁ¥†
        toast.classList.add('toast');
        toast.textContent = textContent;

        var container = document.getElementById('toastContainer');// Â∞ÜToastÊ∑ªÂä†Âà∞ÂÆπÂô®‰∏≠
        container.appendChild(toast);

        if (darkMode) {
            toast.classList.toggle('dark-mode');// ËÆæÁΩÆÊ∑±Ëâ≤Ê®°Âºè
        }

        setTimeout(function () {// ÊòæÁ§∫Toast
            toast.classList.add('show');
        }, 30);

        setTimeout(function () {// ÈöêËóèToast
            toast.classList.add('hide');
            setTimeout(function () {
                container.removeChild(toast);
            }, 300);
        }, 1000);
    }
    //filesize ËΩ¨Êç¢Â∏¶Âçï‰Ωç
    function getReadableFileSizeString(fileSizeInBytes) {
        var i = -1;
        var byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];
        do {
            fileSizeInBytes /= 1024;
            i++;
        } while (fileSizeInBytes > 1024);

        return Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];
    }
</script>

<script src="axios.js"></script>
<script>
    // set api url
    axios.defaults.baseURL = 'http://localhost:3000/box1';

    // upload
    function uploadFile() {
        let config = {
            url: '/upload',
            method: 'Post',
            data: {
                the_file: document.querySelector('#the_file').files[0]
            },
            headers: {
                'Content-Type': 'multipart/form-data'
            }
        }
        axios(config)
            .then((response) => {
                console.log(response);
                showToast('‚úÖ Upload success', false);
            })
    }
    // upload - choosing by clicking input text
    function choosefile() {
        console.log('choosing');
        document.getElementById("the_file").click();
    }
    // upload - get file size and name
    let fileinput = document.querySelector('#the_file');
    fileinput.addEventListener('change', (e) => {
        let file_lable_input = document.querySelector('#file_lable');
        file_lable_input.value = '[' + getReadableFileSizeString(fileinput.files[0].size) + '] ' + fileinput.files[0].name;
    })

    // refresh the filelist 
    function refreshFilelist() {
        axios.get('/filelist')
            .then((response) => {
                console.log(response);
                let filelist = document.querySelector('.filelist');
                filelist.innerHTML = '';
                for (let i = 0; i < response.data.length; i++) {
                    let file = document.createElement('div');
                    file.classList.add('file');

                    let filename = response.data[i]
                    file.innerHTML =
                        '<span class="file-icon">' +
                        getIconbyExtension(filename) +
                        '</span> <small class="file-name"> '+ shortName(filename) + '</small>' +
                        '<span class="file-actions"><button>üíæ</button><button>üóëÔ∏è</button></span>';
                    filelist.appendChild(file);
                }
                let filelistinfo = document.querySelector('#filelist_info');
                filelistinfo.value = response.data.length + '_files';//ËÆ°Êï∞Âô®

            })
    }
    //getIconbyExtension
    function getIconbyExtension(file) {
        let extension = file.split('.')[1];
        switch (extension) {
            case 'png':
                return 'üñºÔ∏è';
            case 'jpg':
                return 'üñºÔ∏è';
            case 'gif':
                return 'üñºÔ∏è';
            case 'zip':
                return 'üì¶';
            case 'txt':
                return 'üìú';
            case 'exe':
                return 'üíΩ';
            default:
                return 'üß©';
        }
    }
    function shortName(filename){
        if (filename.length<=30)
            return filename;
        else{
            let extension = '';
            if (filename.split('.')[1]!=null)
                extension = filename.split('.')[1];
            let a = filename.slice(0, 25) + '...';
            let b = a + ' .' +extension
            return b;
        }
        
    }

</script>
</html>